<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Daoyuan's Fast Robots</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#page-top">
                <span class="d-block d-lg-none">Daoyuan Jin</span>
                <span class="d-none d-lg-block"><img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="assets/img/profile.jpg" alt="..." /></span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#aboutme">aboutme</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab1">lab1</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="#lab2">lab2</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <div class="container-fluid p-0">
            <!-- Home -->
            <section class="resume-section" id="home">
                <div class="resume-section-content">
                    <h1 class="mb-0">
                        ECE5160
                        <span class="text-primary">Fast Robots</span>
                    </h1>
                    <div class="subheading mb-5">
                        Daoyuan Jin · ECE Grad Student ·
                        <a href="dj368@cornell.edu">dj368@cornell.edu</a>
                    </div>
                    <p class="lead mb-5">Hi there. Welcome to my webpage for ECE 5160 Fast Robots. Most of the links here are still under construction...</p>
                    <div class="social-icons">
                        <a class="social-icon" href="#!"><i class="fab fa-linkedin-in"></i></a>
                        <a class="social-icon" href="#!"><i class="fab fa-github"></i></a>
                        <a class="social-icon" href="#!"><i class="fab fa-twitter"></i></a>
                        <a class="social-icon" href="#!"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>
            </section>
            <hr class="m-0" />            
            
            <!-- About me -->
            <section class="resume-section" id="aboutme">
                <div class="resume-section-content">
                    <h2 class="mb-5">about me</h2>
                    <p>I'm a graudate student in CAIR lab, Cornell AgriTech. During my free time I'd like to go outdoors.</p>
                    <p class="mb-0">To be continued.</p>
                </div>
            </section>
            <hr class="m-0" />

            <!-- LAB 1 -->
            <section class="resume-section" id="lab1">
                <div class="resume-section-content">
                    <h2 class="mb-5">LAB1: The Artemis board and Bluetooth</h2>

                    <h2 class="mb-5">PART1: The Artemis board</h2>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Lab Objective</h3>
                            <p>This part acts like a introduction to the Artemis board and the Arduino IDE. By testing examples in the library, we gradually become familiar with the process of using Arduino boards.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Prelab</h3>
                            <p>Setup Arduino environment is reletively simple. We first install the Arduino IDE and install the Sparkfun Appollo3 library accodring to the setup instructions. Then hook the Artemis board up to the computer, select a corresponding borad. Now we are good to uploud examples.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Example: Blink it Up</h3>
                            <p>As the first code we tested, the "Blink it up" example turns the LED on and off periodically.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/353Emwl2QN0" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Example: Serial</h3>
                            <p>In this example we test the serial output and the function of serial monitor. When we send an input to interface, the Artemis board would send it back to the serial monitor as the video shows.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/CmzyefaJIZQ" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Example: analogRead</h3>
                            <p>In the third example we test the fuction of temperature sensor and the board's ability to read analog values. As you can see in the video, the original "temp" value is around 33.9 Celsius. I hold the board still for a while and the reading goes up a little to 34.0 Celsius.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/lKkR116vCI0" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Example: MicrophoneOutput</h3>
                            <p>This example tests the function of microphone unit. It has the ability to print out the loudest frequency the board received.</p>
                            <p>Please turn down your volume a little bit before click the video. Thanks for your understanding!</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/2xZcox5h8T4" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">5000-level: Electronic Tuner</h3>
                            <p>On top of the MicrophoneOutput example, I write a code to make the board act like a electronic tuner. As the "Ode To Joy" goes, the board will identify the frequency of each note and print out a "C", "E" or "F" whenever it encounter one. (Unfortunately there are no "A"s in Ode To Joy.) And it will blink for 0.5 second when it hear a "C", which can be noticed in the video.</p>
                            <p>The logic behind is pretty simple. We can search on the internet for the frequencies of musical notes. For example, C5 is 523.25Hz. But in my case, it turns out to be around 526Hz. Due to the deviation in pitch accuracy, and certain overtones produced during the instrument performance, it's hard to fully encode all the musical notes. But it can be an interesting task in the future practice.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/Ku1s3unY-Mc" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <h2 class="mb-5">PART2: Bluetooth</h2>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Lab Objective</h3>
                            <p>The objective of this part is to establish communication between PC and the Artemis board through the Bluetooth connection. On PC side we use Python3 in Jupyter notebook, while on the Artemis side we use the Arduino programming language, which is a simplified version of C/C++. We will get familiar with the process of sending data via Bluetooth that will be useful in future labs.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Prelab</h3>
                            <div class="subheading mb-3">1. Setup</div>
                            <p>PC side: Install Python, Create and Activate Virtual Environment, Install Python Packages, Using Jupyter Server.</p>
                            <p>Artemis side: Install ArduinoBLE, Using ble_arduino.ino.</p>
                            <p>For this 2024 spring class, I'm using Win11 and I went through all the setups and tasks without using WSL, although I still spent some time trying to install it. It turns out that all the errors popped up can be fixed inside Windows11.</p>
                            <div class="subheading mb-3">2. Codebase</div>
                            <p>The Python and Artemis packages are provided to establish a basic communication between PC and the Artemis board through BLE. We will modify on top of the codebase</p>
                            <p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Workflow</h3>
                            <p>To start with, let me priefly introduce the general workflow of writing a new bluetooth function.</p>
                            <p>On Artemis side: Twosteps. First, add CommandTypes, so that the board can handle commands accordingly. Second, add a case under switch function, define the specific function inside this case. Typical output steps are Serial.print() and tx_characteristic_string.writeValue(), which print out to the serial monitor and send message via bluetooth, respectively.</p>
                            <p>On PC side: add CMD(Enum) in cmd_types.py just like CommandTypes</p>
                            <code>class CMD(Enum):<br>
                                    PING = 0<br>
                                    SEND_TWO_INTS = 1<br>
                                    SEND_THREE_FLOATS = 2<br>
                                    ECHO = 3<br>
                            </code>
                            <p>Use ble.send_command() and ble.receive_string() pair to send and receive message. Or use ble.start_notify() to start a notification handler, which we will cover below.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Establish Bluetooth Connection</h3>                            
                            <p>First, upload the ble_arduino.ino into the board. Once finished, the MAC address will be printed in the serial monitor. Replace the first line in connection.yaml file with this address.</p>
                            <p>Second, in order to differentiate from other students' boards, generate a new Universally Unique Identifier (UUID) by using lines below.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/uuid.png" alt="">
                            <p>Replace the second line in connection.yaml file with this UUID. Replace the BLEService UUID in ble_arduino.ino with this UUID too.</p>
                            <p>Last, run the demo.ipynb notebook to make sure Bluetooth connection is established.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/rh8XcAS1fWI" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task1: ECHO</h3>
                            <p>First we write a "ECHO" command to let Artemis send back a signitured string to test the send & receive functions via bluetooth. On PC side the code and result looks like this:</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/echo_py.png" alt="">
                            <p>On Artemis side the code looks like this:</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/echo_ar.png" alt="">
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task2: GET TIME MILLIS</h3>
                            <p>On top of string transmission, we use millis() function in Artemis to send back the time information. On PC side the code and result looks like this:</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/millis_py.png" alt="">
                            <p>On Artemis side the code looks like this:</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/millis_ar.png" alt="">
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task3: Notification Handler</h3>
                            <p>When we use ble.receive_string to receive information from Artemis, the entire Python program enters a waiting state and does not handle other tasks, which is very time-consuming in practical use. To address this issue, we developed the Notification Handler function. When we activate this function, the callback function is called to process the information every time Bluetooth receives it, and it does not occupy the thread when there is no new information. The following video shows the specific implementation and result:</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/aDigYVjs5FY" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>


                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task4: Data Transfer Rate</h3>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/rate.png" alt="">
                            <p>Now we write a loop in Artemis (show in the picture above) that gets the current time in milliseconds and sends it to PC to be received and processed by the notification handler. Collect for around 5s and calculate the effective data transfer rate. As the video shows, during 5s the PC received around 200 timestamps, thus indicating a data transfer rate 40/s.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/KvO5sbs1OFo" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task5: SEND TIME DATA</h3>                            
                            <p>We also have different ways to transfer data. Instead of sending message once a time, we can store it in an array first. Once we send request from PC for the timestamps then the board send all its data to PC.</p>
                            <p>To address this we first add the following lines in the loop (besides default write_data() and read_data()) to store timestamps. Once the array is full we overwrite old data with new data while always preserving the index information of the data in the array, allowing us to know from which position to start reading when sending data.</p>
                            <code>
                                timestamps[myindex] = (int)millis();<br>
                                myindex += 1;<br>
                                if (myindex > MAXSIZE){<br>
                                myindex = 0; <br>
                                }                                <br>
                                write_data(); // Send data<br>
                                read_data(); // Read data<br>
                            </code>
                            <p>After that we define "case: SEND_TIME_DATA" in Artemis and "SEND TIME DATA" in Python as shown in the video. In this example, I define the array length to be 255, each time we want to get timestamps from Artemis, it will send us this array in sequence.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/lUwt-pHpjF8" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task6: GET TEMP READINGS</h3>                                                        
                            <p>To get synchronized time and temperature data, we simply add the corresponding part for temperature as timestamp in Task5. The video shows that both Artemis and PC fulfilled the requirement.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/PFC5NmynVaM" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task7: Discussion</h3>
                            
                            <p>One data at a time: this method doesn't count on the RAM, if we are dealing with single piece large data and small RAM, we'd better choose this method.</p>
                            <p>Sending data after storage: this method has the ability to record denser data points campared with the former, also this method allows the robot temporarily disconnecting with PC (although in our case it's not possible).</p>
                            <p>The Artemis board has 384 kB of RAM. If we use all of the RAM to store our data, and one sample value is 32-bits (string in utf-8), then it will be 12000 values storage.</p>
                            
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">5000-level: Effective Data Rate And Overhead</h3>
                            <p>To test the relationship between data length and data rate, I modified the ECHO function to an exact sentback mode. Then I proceed a expriment to calculate the time it takes for transmitting one byte of data.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/data_rate.jpg" alt="">
                            <p>The result graph shows that by increasing the data length, the effective data rate gradually increase as well.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">5000-level: Reliability</h3> 
                            <p>By comparing the stored data in Artemis and PC, I found that the computer read all the data published by Artemis, even if Artemis sends at a higher rate.</p>
                        </div>
                    </div>

                </div>
            </section>
            <hr class="m-0" />

            <!-- LAB 2 -->
            <section class="resume-section" id="lab2">
                <div class="resume-section-content">
                    <h2 class="mb-5">LAB2: IMU</h2>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Lab Objective</h3>
                            <p>In the second lab we add a IMU to our robot (Artemis board). We record and process the Accelerometer and Gyroscope data, and implement a low pass filter to improve the data quality. We also test the RC car to get a sense of future work.</p>
                        </div>
                    </div>


                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task1: Set up the IMU</h3>
                            <p>We use the Sparkfun breakout board as IMU, and install the SparkFun 9DOF IMU Breakout - ICM 20948 - Arduino Library through the Arduino library manager.</p>
                            <p>Connect the IMU to the Artemis board using the QWIIC cable.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/imu.jpg" alt="">
                            <p>Run basic example to read the sensor data. As you can see in this video, Accelerometer and Gyroscope both have X, Y, Z three dementional data. As I rotate, flip and accelerate the board, data change accordingly. Next we will use functions to convert these data to the gesture of the board.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/PwWLxMT4WnA" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p>The definition of AD0_VAL is confusing. In my case I have to set to 0 to get the sensor data. However, on my board the ADDR jumper is soldered, which indicate I should use 1 to get default setting. Anyway, "0" works.</p>
                            <p>Furthermore, as suggested in the instruction, I add a blink function in the setup of Artemis board. You can see the blue light blink three times on start-up.</p>
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task2: Accelerometer</h3>
                            <p>First we use the following equations the convert Accelerometer data into pitch and roll.</p>
                            <img class="img-fluid img-centered" src="assets/img/lab2/accequation.png" alt="">
                            <p>In Artemis it goes like this:</p>
                            <code>
                                pitch_a = atan2(myICM.accY(),myICM.accZ())*180/M_PI; <br>
                                roll_a  = atan2(myICM.accX(),myICM.accZ())*180/M_PI; <br>
                            </code>
                            <p>To demonstrate the accuracy of Acc data, we show the output at {-90, 0, 90} degrees for pitch and roll respectively.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch_roll_0.png" alt="">
                            <p>Picture1 pitch & roll @ 0 degree </p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch-90.png" alt="">
                            <p>Picture2 pitch @ -90 degree </p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch90.png" alt="">
                            <p>Picture3 pitch @ 90 degree </p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/roll-90.png" alt="">
                            <p>Picture4 roll @ -90 degree </p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch90.png" alt="">
                            <p>Picture5 roll @ 90 degree </p>
                            <p>We can see that there is noise in the data but generally accurate.</p>
                            <p>Upon applying linear regression to the three-point dataset, we observe a minor offset and a slope coefficient below 1.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/measurepitch.jpg" alt="">
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/measureroll.jpg" alt="">
                            <p>By manipulating the equations in the graph, we can derive the conversion factor. However, this data exhibits significant randomness and is heavily influenced by the desk's incomplete horizontal/vertical alignment during the experiment.</p>
                            <!-- FFT -->
                            <div class="subheading mb-3">Low Pass Filter</div>
                            <p>The accelerometer is noisy. To address this issue by using low pass filter, we first to analyze the noise in the frequency spectrum</p>
                            <p>Here is a helpful reference on <a href="https://pythonnumericalmethods.berkeley.edu/notebooks/chapter24.04-FFT-in-Python.html">Fourier Transform</a>.</p>
                            <p>Take pitch data as an example, I collected nearly a thousand data points while the board was stationary. The collected data and the data after Fourier transformation are shown in the graph.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch.png" alt="">
                            <p>From the results, it appears that the intensity of the noise is much lower than the intensity of the signal. Perhaps there is no need to add another low pass filter.</p>
                            <p>In fact, by checking the datasheet, we found that the IMU has a built-in low-pass filter. However, upon closer examination, I believe that this function is not enabled in the mode we are using.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/builtinLPF1.png" alt="">
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/builtinLPF2.png" alt="">
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/builtinLPF3.png" alt="">
                            <p>Anyway, we can still add an additional low-pass filter to see its effect.</p>
                            <!-- LPF -->
                            <p>Take pitch as an example, the implementation of a low pass filter is like this:</p>
                            <code>
                                const float alpha = 0.2; <br>
                                pitch_a_LPF[1] = alpha*pitch_a + (1-alpha)*pitch_a_LPF[0]; <br>
                                pitch_a_LPF[0] = pitch_a_LPF[1]; <br>
                            </code>
                            <p>We have a list, pitch_a_LPF[], of two doubles, to record the previous and present pitch data, and implement LPF by adjusting the parameter alpha.</p>
                            <p>Mathematically, the cutoff frequency is defined as the frequency at which the output power of the filter is reduced to half of its maximum value. In terms of the transfer function of the filter, the cutoff frequency is the frequency at which the magnitude response is 0.707 times the maximum magnitude. Here we set alpha=0.2.</p>
                            <p>This is the result of pitch data after applying the low pass filter:</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/pitch_lpf.png" alt="">
                            <p>In this experiment I recorded around 1000 data points. Starting from 500 I added some vibration to the Artemis board. In my opinion, the figure in the frequency spectrum is pretty decent.</p>
                            <p>By contrast, the roll data was recorded simultaniously but without a low pass filter. Shown as below.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/row_wo_lpf.png" alt="">
                        </div>
                    </div>

                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task3: Gyroscope</h3>
                            <p>The reading of the gyroscope is the angular acceleration of the XYZ coordinates. By integrating them separately, we can obtain the angles of the three coordinates. Artemis implementation is as follows:</p>
                            <code>
                                pitch_g = pitch_g + myICM.gyrX()*dt; <br>
                                roll_g = roll_g + myICM.gyrY()*dt; <br>
                                yaw_g = yaw_g + myICM.gyrZ()*dt; <br>
                            </code>
                            <p>This video shows the pitch, roll, and yaw data we get from Gyroscope.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/Q25W1ZCYl1M" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p>You can see from the video that the data of Gyroscope is pretty smooth ~</p>
                            <p>Now we compare the pitch data from Accelerometer and Gyroscope. We can get pitch output from Accelerometer and Gyroscope simultaniously, and the results are as follows:</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/S5qKoHjtD2I" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p>We can see that the pitch noise obtained from the accelerometer is very large, while the pitch obtained from the gyroscope is very smooth. However, the data obtained from the gyroscope has accumulated errors; when the board is stationary, the pitch calculated by the gyroscope still changes.</p>
                            <!-- change sampling frequency -->
                            <p>Additionally, we change the sampling frequency to see how it affects the accuracy of gyroscope data.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/lowerf.png" alt="">
                            <p>After lowering the frequency, the accumulated error in gyroscope data becomes more pronounced, while the accelerometer data remains unaffected. This indicates that the sampling frequency is crucial for the accuracy of gyroscope data.</p>
                            <div class="subheading mb-3">Complimentary Filter</div>
                            <!-- conbine -->
                            <p>To address the issue of high noise in accelerometer readings without cumulative errors, and low noise but cumulative errors in gyro readings, we merge the readings of both sensors using the following filter:</p>
                            <img class="img-fluid img-centered" src="assets/img/lab2/combineequation.png" alt="">
                            <p>Artemis implementation:</p>
                            <code>
                                pitch_g_delta = myICM.gyrX()*dt; <br>
                                roll_g_delta = myICM.gyrY()*dt; <br>
                                
                                pitch_a = atan2(myICM.accY(),myICM.accZ())*180/M_PI; <br>
                                roll_a  = atan2(myICM.accX(),myICM.accZ())*180/M_PI; <br>

                                pitch = (pitch + pitch_g_delta)*(1-alpha) + pitch_a * alpha; <br>
                                roll = (roll + roll_g_delta)*(1-alpha) + roll_a * alpha; <br>
                                yaw = yaw + myICM.gyrZ()*dt; <br>
                            </code>
                            <!-- alpha -->
                            <p>Here alpha is set to 0.1 based on practical experience. Now the pitch and roll we get is both accurate and stable.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/iFTiorOolmY" frameborder="0" allowfullscreen></iframe>
                            </div>
                        </div>
                    </div>


                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task4: Sample Data</h3>
                            <div class="subheading mb-3">Speed Up</div>
                            <p>Just like the GET TEMP READINGS task in lab2, we store the timestamps and IMU data in an array and send to PC once the Artemis board received a command.</p>
                            <p>The data we received on PC looks like this.</p>
                            <img width="640" height="360" class="img-fluid img-centered" src="assets/img/lab2/speedup.png" alt="">
                            <p>We can see that the sample rate is around 3.15ms, which is around 317Hz. I've written in the code that if the IMU data is not ready, 0 will be filled into the array. But we didn't receive 0s in the array which indicates that the main loop on the Artemis run slower than the IMU produces new values.</p>

                            <div class="subheading mb-3">Data Storage</div>
                            <p>Firstly, I think it makes more sense to store Timestamp, Accelerometer, Gyroscope, and ToF separately. It would be easier to locate data by index in separate arrays than a single combined one. Also, it would be more convenient to use separate arrays if we are dealing with different data types.</p>
                            <p>Secondly, data types. I would use integers (2or4 bytes) for timestamp, floats (4 bytes) for Accelerometer (X,Y,Z) and Gyroscope (X,Y,Z) data to save storage.</p>
                            <p>Lastly, the above mentioned sample rate would be too large to deal with. If we choose to record at a sample rate of around 50Hz, we will use 1400 bytes per second. With the 384kB internal storage we can store around 274s.</p>
                            <div class="subheading mb-3">5S Time-stamped IMU Data</div>
                            <p>Here is the video to demonstrate the ability to record 5 second of data.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/VREiisrrA1g" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p>One can tell from the timestamps that the time span is longer than 5s and we have recorded 255 sample points.</p>
                        </div>
                    </div>


                    <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                        <div class="flex-grow-1">
                            <h3 class="mb-0">Task5: Record a Stunt</h3>                                                        
                            <p>To get a sense of how RC car moves, we use the remote control to drive the car.</p>
                            <div class="embed-contaioner">
                                <iframe width="640" height="360" src="https://www.youtube.com/embed/qss7fXpiP84" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p>The RC car moves forward, backward, and turns at very high speeds. During remote control, each step is large, and fine adjustments cannot be made. It seems that the car's speed only have one gear, leaving a lot of room for optimization.</p>
                        </div>
                    </div>

                </div>
            </section>
            <hr class="m-0" />
            
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
